#!/bin/bash

## not sophisticated
## create the server directory structure and populate it
## build the binary into the web site directory and rename it

CONF_FILE=conf/ipgo.conf

[ -f $CONF_FILE ] || { echo cannot find config file: $CONF_FILE; echo exiting; exit 0; }

# Read the website_directory setting from the config file.
while read opt val;
do
    if [ $opt = "website_directory" ]; then
        WEBSITE_DIRECTORY=$val
    fi
done < $CONF_FILE

echo installing to $WEBSITE_DIRECTORY

echo "continue? (y/N)"

read -rsn1 c
if [ "$c" != "y" ]; then
    echo "Not installing."
    exit 1
fi

mkdir -p $WEBSITE_DIRECTORY
mkdir -p $WEBSITE_DIRECTORY/bin
mkdir -p $WEBSITE_DIRECTORY/css
mkdir -p $WEBSITE_DIRECTORY/images
mkdir -p $WEBSITE_DIRECTORY/html
mkdir -p $WEBSITE_DIRECTORY/conf

go build -o ${WEBSITE_DIRECTORY}/bin/ip.cgi  src/ip.go
install -m644 css/ip.css ${WEBSITE_DIRECTORY}/css/
install -m644 images/background.png ${WEBSITE_DIRECTORY}/images/
install -m644 html/ip.html ${WEBSITE_DIRECTORY}/html/
install -m644 html/error.html ${WEBSITE_DIRECTORY}/html/
install -m644 conf/ipgo.conf ${WEBSITE_DIRECTORY}/conf/

echo "Finished installing."
